{% extends "base.html" %}

{% block title %}Football Games:{% endblock %}

{% block css %}
#football-history-panel {
  margin-top: 20px;
  margin-bottom: 20px;
  height: 1500px;
}
#football-history {
  float: left;
  width: 60%;
}

#football-odd-detail {
  float: right;
  width: 40%;
  border: 1px solid blue;
  margin-top: 10px;
  height: 90%;
}
.board {
  margin-top: 10px;
  margin-left:30px;
  margin-right:30px;
  marigin-bottom: 10px;
  border: 1px solid green;
  height: 300px;
}
{% endblock %}
{% block main-panel %}
{% include "history/form_inline.html" %}
<div id="football-history-panel">
  <div id='football-history'>
    <table id="football-history-table" class="table table-hover table-striped">
      <thead>
        <tr>
          <th>开球时间</th>
          <th>联赛</th>
          <th>主队</th>
          <th>客队</th>
          <th>比分</th>
          <th>赔率</th>
        </tr>
      </thead>
      <tbody>
      {% for game in games %}
      <tr>
        <td>{{ game.datetime|date:"Y-m-d H:i" }}</a></td>
        <td>{{ game.leagueName }}</td>
        <td>{{ game.homeTeam }}</td>
        <td>{{ game.awayTeam }}</td>
        <td>{{ game.homeScore }}:{{ game.awayScore }}</td>
        <td><a href="#" onclick="return showOdds('{{ game.id }}')" class="btn btn-xs btn-primary"> >> </a></td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <div id="football-odd-detail">
    <div id="win-panel" class="board" >

    </div>
    <div id="draw-panel" class="board" >
    </div>
    <div id="lose-panel" class="board" >
    </div>
    <div id="panel-text">

    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script src="{{ STATIC_URL }}js/dtpicker.js"></script>
<script language="JavaScript">
$("#football-history-table").DataTable({
    searching: true,
    paging: true,
    lengthMenu: [[20, 50], [20, 50]],
    order: [[ 0, 'desc' ]],
})
</script>
<script language="javascript">
function showOdds(gameID)
{
  var url = '/history/json/get_odds/' + gameID
  $.ajax({
      url: url,
      type: 'GET',
      async: true,
      dataType: "json",
      success: function (data) {
          odd_layout(data);
      }
  });
}
</script>
<script language="JavaScript">
function odd_layout(data) {
  $('#panel-text').html(data['odd_win'])
  $('.board').each( function() {
    var values = [];
    var mark = this.id;
    if (mark == 'win-panel') {
      values = data['odd_win']
    } else if (mark == 'draw-panel') {
      values = data['odd_draw']
    } else if (mark == 'lose-panel') {
      values = data['odd_lose']
    }
    $(this).highcharts({
      chart: {
        zoomType: 'x',
        resetZoomButton: {
          position: {
            x: 0,
            y: -30
          }
        }
      },
      title: {
        text: mark.toUpperCase(),
        x: -15 //center
      },
      xAxis: {
        categories: data['x_names'],
        labels: {
          rotation: 60,
          step: 3
        }
      },
      yAxis: {
        title: {
          text: $(this).id
        },
        plotLines: [{
          value: 0,
          width: 1,
          color: '#808080'
        }],
        min: 0,
      },
      tooltip: {
        formatter: function() {
            return '';
          }
      },
      series: values,
      noData: {
        style: {
          fontWeight: 'bold',
          fontSize: '15px',
           color: '#303030'
        }
      }
    });
  });
};

</script>
{% endblock %}